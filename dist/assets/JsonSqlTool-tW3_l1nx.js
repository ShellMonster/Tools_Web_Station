import{r as N,j as e}from"./vendor-E1qkQgBK.js";import{B as x}from"./Button-S8-yJkDU.js";import{S as I}from"./Select-BKMIeGih.js";import{T as b}from"./TextArea-BoVf9nms.js";import{T as w}from"./ToolSection-D3WFVMtC.js";import{c as y}from"./clipboard-4Xj0hnU0.js";import{u as A}from"./index-T0krPfu9.js";import"./format-parsers-Cy82sy8R.js";import"./mermaid-qV9g4jTJ.js";const O=s=>String(s).replace(/'/g,"''"),j=s=>s==null?"NULL":typeof s=="number"&&Number.isFinite(s)?String(s):typeof s=="boolean"?s?"TRUE":"FALSE":s instanceof Date?`'${O(s.toISOString())}'`:`'${O(s)}'`,c=s=>s,C=(s=[])=>{const a=[];return s.forEach((t,r)=>{if(!t||!t.field)return;const n=(t.operator||"=").toUpperCase(),l=r>0?` ${(t.logical||"AND").toUpperCase()} `:"";if(n==="IN"||n==="NOT IN"){const o=Array.isArray(t.value)?t.value.map(j).join(", "):j(t.value);a.push(`${l}${c(t.field)} ${n} (${o})`);return}if(t.value===null&&(n==="="||n==="IS")){a.push(`${l}${c(t.field)} IS NULL`);return}if(t.value===null&&(n==="!="||n==="<>"||n==="IS NOT")){a.push(`${l}${c(t.field)} IS NOT NULL`);return}a.push(`${l}${c(t.field)} ${n} ${j(t.value)}`)}),a.join("")},R=s=>!s||typeof s!="object"?"":Array.isArray(s)?C(s):Object.entries(s).map(([t,r])=>{if(r&&typeof r=="object"&&!Array.isArray(r)){const n=(r.operator||"=").toUpperCase();if((n==="IN"||n==="NOT IN")&&Array.isArray(r.value)){const l=r.value.map(j).join(", ");return`${c(t)} ${n} (${l})`}return r.value===null&&(n==="="||n==="IS")?`${c(t)} IS NULL`:r.value===null&&(n==="!="||n==="<>"||n==="IS NOT")?`${c(t)} IS NOT NULL`:`${c(t)} ${n} ${j(r.value)}`}if(Array.isArray(r)){const n=r.map(j).join(", ");return`${c(t)} IN (${n})`}return`${c(t)} = ${j(r)}`}).join(" AND "),$=s=>{const a=Array.isArray(s)?C(s):R(s);return a?` WHERE ${a}`:""},D=s=>{if(!s)return"";if(Array.isArray(s)){const a=s.map(t=>{if(!t)return null;if(typeof t=="string")return`${c(t)}`;if(t.field){const r=(t.direction||"ASC").toUpperCase();return`${c(t.field)} ${r}`}return null}).filter(Boolean);return a.length?` ORDER BY ${a.join(", ")}`:""}if(typeof s=="object"&&s.field){const a=(s.direction||"ASC").toUpperCase();return` ORDER BY ${c(s.field)} ${a}`}return typeof s=="string"?` ORDER BY ${c(s)}`:""};function U(s,a="select"){let t;try{t=JSON.parse(s)}catch{throw new Error("JSON 解析失败，请检查输入格式")}const r=(a||t.type||"select").toLowerCase(),n=t.table;if(!n)throw new Error("JSON 中缺少表名 (table)");if(r==="select"){const l=Array.isArray(t.columns)&&t.columns.length?t.columns.map(c).join(", "):"*",o=$(t.where),d=D(t.orderBy),m=Array.isArray(t.groupBy)&&t.groupBy.length?` GROUP BY ${t.groupBy.map(c).join(", ")}`:"",i=t.limit?` LIMIT ${Number(t.limit)}`:"",u=t.offset?` OFFSET ${Number(t.offset)}`:"";return`SELECT ${l} FROM ${c(n)}${o}${m}${d}${i}${u};`}if(r==="insert"){const l=Array.isArray(t.values)?t.values:t.values?[t.values]:[];if(!l.length||typeof l[0]!="object")throw new Error("INSERT 需要提供 values 字段，并包含至少一条记录");const o=Object.keys(l[0]),d=o.map(c).join(", "),m=l.map(i=>`(${o.map(u=>j(i[u])).join(", ")})`).join(", ");return`INSERT INTO ${c(n)} (${d}) VALUES ${m};`}if(r==="update"){const l=t.set;if(!l||typeof l!="object")throw new Error("UPDATE 需要提供 set 字段，指定要更新的列");const o=Object.entries(l).map(([m,i])=>`${c(m)} = ${j(i)}`).join(", "),d=$(t.where);if(!d)throw new Error("UPDATE 操作建议提供 WHERE 条件以避免全表更新");return`UPDATE ${c(n)} SET ${o}${d};`}if(r==="delete"){const l=$(t.where);if(!l)throw new Error("DELETE 操作必须提供 WHERE 条件以避免全表删除");return`DELETE FROM ${c(n)}${l};`}throw new Error(`暂不支持的操作类型：${r}`)}const J=s=>s.replace(/\s+/g," ").trim(),S=s=>{const a=s.trim();if(/^null$/i.test(a))return null;if(/^true$/i.test(a))return!0;if(/^false$/i.test(a))return!1;if(/^'.*'$/.test(a))return a.slice(1,-1).replace(/''/g,"'");if(/^".*"$/.test(a))return a.slice(1,-1);const t=Number(a);return Number.isNaN(t)?a:t},v=s=>{if(!s)return[];const a=s.split(/\s+(AND|OR)\s+/i),t=[];for(let r=0;r<a.length;r+=2){const n=a[r];if(!n)continue;const l=r===0?null:a[r-1].toUpperCase(),o=n.match(/([^\s]+)\s*(=|!=|<>|>=|<=|>|<|LIKE|NOT LIKE|IN|NOT IN|IS|IS NOT)\s*(.+)/i);if(!o)continue;const[,d,m,i]=o,u=m.toUpperCase();if(u==="IN"||u==="NOT IN"){const p=i.replace(/[()]/g,"").split(",").map(S);t.push({field:d,operator:u,value:p,logical:l})}else u==="IS"||u==="IS NOT"?t.push({field:d,operator:u,value:S(i),logical:l}):t.push({field:d,operator:u,value:S(i),logical:l})}return t};function k(s){if(!s||!s.trim())throw new Error("请先输入 SQL 语句");const a=J(s),t=a.toUpperCase();if(t.startsWith("SELECT")){const r=a.match(/select\s+(.+?)\s+from\s+([^\s]+)(.*)/i);if(!r)throw new Error("无法解析 SELECT 语句");const[,n,l,o=""]=r,d=n.trim()==="*"?["*"]:n.split(",").map(E=>E.trim()),m=o.match(/where\s+(.+?)(order by|group by|limit|offset|$)/i),i=o.match(/order by\s+(.+?)(limit|offset|$)/i),u=o.match(/group by\s+(.+?)(order by|limit|offset|$)/i),p=o.match(/limit\s+(\d+)/i),f=o.match(/offset\s+(\d+)/i);return{type:"select",table:l,columns:d,where:m?v(m[1]):[],groupBy:u?u[1].split(",").map(E=>E.trim()):void 0,orderBy:i?i[1].split(",").map(E=>{const[T,g]=E.trim().split(/\s+/);return{field:T,direction:g?g.toUpperCase():"ASC"}}):void 0,limit:p?Number(p[1]):void 0,offset:f?Number(f[1]):void 0}}if(t.startsWith("INSERT")){const r=a.match(/insert\s+into\s+([^\s]+)\s*\((.+?)\)\s*values\s*(.+);?/i);if(!r)throw new Error("无法解析 INSERT 语句");const[,n,l,o]=r,d=l.split(",").map(i=>i.trim()),m=o.split("),").map(i=>i.replace(/[()]/g,"").trim()).map(i=>{const u=i.split(",").map(f=>S(f)),p={};return d.forEach((f,E)=>{p[f]=u[E]}),p});return{type:"insert",table:n,columns:d,values:m}}if(t.startsWith("UPDATE")){const r=a.match(/update\s+([^\s]+)\s+set\s+(.+?)(\s+where\s+(.+))?;?$/i);if(!r)throw new Error("无法解析 UPDATE 语句");const[,n,l,,o]=r,d=l.split(",").map(i=>i.trim()),m={};return d.forEach(i=>{const[u,p]=i.split("=").map(f=>f.trim());m[u]=S(p)}),{type:"update",table:n,set:m,where:o?v(o):[]}}if(t.startsWith("DELETE")){const r=a.match(/delete\s+from\s+([^\s]+)(\s+where\s+(.+))?;?$/i);if(!r)throw new Error("无法解析 DELETE 语句");const[,n,,l]=r;return l?{type:"delete",table:n,where:v(l)}:{type:"delete",table:n,where:[]}}throw new Error("暂不支持该类型的 SQL 语句解析")}const F=[{value:"select",label:{zh:"查询 (SELECT)",en:"Query (SELECT)"}},{value:"insert",label:{zh:"新增 (INSERT)",en:"Insert (INSERT)"}},{value:"update",label:{zh:"更新 (UPDATE)",en:"Update (UPDATE)"}},{value:"delete",label:{zh:"删除 (DELETE)",en:"Delete (DELETE)"}}],K=()=>{const[s,a]=N.useState(""),[t,r]=N.useState(""),[n,l]=N.useState(""),[o,d]=N.useState(""),[m,i]=N.useState("select"),[u,p]=N.useState(""),{t:f,locale:E}=A(),T=()=>{try{const h=U(s,m);r(h),p("")}catch(h){p(f(h.message))}},g=()=>{try{const h=k(n);d(JSON.stringify(h,null,2)),p("")}catch(h){p(f(h.message))}},L=()=>{a(""),r(""),l(""),d(""),p("")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{title:"JSON ↔ SQL 转换",description:"将结构化 JSON 转为常见 SQL 语句，支持 SELECT / INSERT / UPDATE / DELETE；也能解析简单 SQL 为 JSON 结构。",actions:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(I,{value:m,onChange:h=>i(h.target.value),className:"w-48",children:F.map(h=>e.jsx("option",{value:h.value,children:h.label[E]},h.value))}),e.jsx(x,{onClick:T,disabled:!s.trim(),children:"JSON → SQL"}),e.jsx(x,{variant:"secondary",onClick:g,disabled:!n.trim(),children:"SQL → JSON"}),e.jsx(x,{variant:"ghost",onClick:L,children:"清空"})]}),children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:f("JSON 输入")}),e.jsx(b,{className:"mt-2 h-72 font-mono",placeholder:`示例：
{
  "table": "users",
  "columns": ["id", "name"],
  "where": [
    {"field": "status", "operator": "=", "value": "active"}
  ],
  "limit": 20
}`,value:s,onChange:h=>a(h.target.value)}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(x,{variant:"secondary",onClick:()=>y(s),disabled:!s,children:"复制输入"}),e.jsx(x,{variant:"ghost",onClick:()=>a(`{
  "table": "orders",
  "columns": ["id", "total", "user_id"],
  "where": [
    { "field": "status", "operator": "=", "value": "paid" },
    { "field": "total", "operator": ">", "value": 100, "logical": "AND" }
  ],
  "orderBy": { "field": "created_at", "direction": "DESC" },
  "limit": 20
}`),children:"载入示例"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:f("SQL 结果")}),e.jsx(b,{className:"mt-2 h-72 font-mono",value:t,readOnly:!0,placeholder:"转换结果将在此显示"}),e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx(x,{variant:"secondary",onClick:()=>y(t),disabled:!t,children:"复制 SQL"})})]})]})}),e.jsxs(w,{title:"SQL ↔ JSON 解析",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:f("SQL 输入")}),e.jsx(b,{className:"mt-2 h-72 font-mono",placeholder:"SELECT id, name FROM users WHERE status = 'active';",value:n,onChange:h=>l(h.target.value)}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(x,{variant:"secondary",onClick:()=>y(n),disabled:!n,children:"复制输入"}),e.jsx(x,{variant:"ghost",onClick:()=>l("INSERT INTO users (name, email) VALUES ('Alice', 'alice@example.com');"),children:"载入示例"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:f("JSON 结果")}),e.jsx(b,{className:"mt-2 h-72 font-mono",value:o,readOnly:!0,placeholder:"解析结果将在此显示"}),e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx(x,{variant:"secondary",onClick:()=>y(o),disabled:!o,children:"复制 JSON"})})]})]}),u?e.jsx("p",{className:"mt-4 text-sm text-red-500",children:u}):null,e.jsx(P,{locale:E})]})]})},P=({locale:s})=>{const a=s==="en",t=N.useMemo(()=>a?[{label:"SELECT:",description:e.jsxs(e.Fragment,{children:["Required field ",e.jsx("code",{className:"whitespace-pre",children:"table"}),"; optional"," ",e.jsx("code",{children:"columns"}),", ",e.jsx("code",{children:"where"})," (object or array), ",e.jsx("code",{children:"orderBy"}),", ",e.jsx("code",{children:"limit"}),", and ",e.jsx("code",{children:"offset"}),"."]})},{label:"INSERT:",description:e.jsxs(e.Fragment,{children:["Provide ",e.jsx("code",{children:"values"})," as an object or array. Keys are mapped to column names automatically."]})},{label:"UPDATE:",description:e.jsxs(e.Fragment,{children:["Use ",e.jsx("code",{children:"set"})," for columns to update and ",e.jsx("code",{children:"where"})," for conditions. The tool warns when WHERE is missing."]})},{label:"DELETE:",description:e.jsxs(e.Fragment,{children:["Always include a ",e.jsx("code",{children:"where"})," clause to avoid deleting entire tables."]})}]:[{label:"SELECT：",description:e.jsxs(e.Fragment,{children:["必填字段 ",e.jsx("code",{className:"whitespace-pre",children:"table"}),"；可选 ",e.jsx("code",{children:"columns"}),"、",e.jsx("code",{children:"where"})," ","(对象或数组)、",e.jsx("code",{children:"orderBy"}),"、",e.jsx("code",{children:"limit"}),"、",e.jsx("code",{children:"offset"}),"。"]})},{label:"INSERT：",description:e.jsxs(e.Fragment,{children:["使用 ",e.jsx("code",{children:"values"})," 指定对象或对象数组，字段名将自动映射列名。"]})},{label:"UPDATE：",description:e.jsxs(e.Fragment,{children:["通过 ",e.jsx("code",{children:"set"})," 指定要更新的列，",e.jsx("code",{children:"where"})," 描述条件；工具会提醒缺失 WHERE 的风险。"]})},{label:"DELETE：",description:e.jsxs(e.Fragment,{children:["必须包含 ",e.jsx("code",{children:"where"})," 条件，避免误删整表。"]})}],[a]);return e.jsxs("div",{className:"mt-6 rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 text-xs leading-relaxed text-slate-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300",children:[e.jsx("p",{className:"font-semibold text-slate-600 dark:text-slate-200",children:a?"JSON structure reference:":"JSON 结构参考："}),e.jsx("ul",{className:"mt-2 space-y-2",children:t.map(r=>e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:r.label})," ",r.description]},r.label))})]})};export{K as default};
